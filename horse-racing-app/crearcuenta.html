<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Horse Racing Bet - Login</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: "#dc2626",
              secondary: "#1e293b",
            },
          },
        },
      };
    </script>
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import {
        getAuth,
        signInWithEmailAndPassword,
        createUserWithEmailAndPassword,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
      import {
        getFirestore,
        doc,
        setDoc,
      } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

      // TODO: Reemplazar con tu configuraci√≥n de Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyAGAkg8tc0AV6WhGxnZISnI0OScaqQV1P0",
        authDomain: "corseweb-914bf.firebaseapp.com",
        projectId: "corseweb-914bf",
        storageBucket: "corseweb-914bf.firebasestorage.app",
        messagingSenderId: "771172579871",
        appId: "1:771172579871:web:47a0015fa0aa4213d2332a",
        measurementId: "G-GMR6X5C05Z",
      };

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);
      const db = getFirestore(app);

      // Estado de la aplicaci√≥n
      let isLogin = true;
      let email = "";
      let password = "";
      let loading = false;

      // Elementos del DOM
      const loginTab = document.getElementById("loginTab");
      const registerTab = document.getElementById("registerTab");
      const emailInput = document.getElementById("emailInput");
      const passwordInput = document.getElementById("passwordInput");
      const errorDiv = document.getElementById("errorDiv");
      const submitBtn = document.getElementById("submitBtn");
      const btnText = document.getElementById("btnText");
      const spinner = document.getElementById("spinner");

      // Cambiar entre login y registro
      loginTab.addEventListener("click", () => {
        isLogin = true;
        updateTabs();
        clearError();
      });

      registerTab.addEventListener("click", () => {
        isLogin = false;
        updateTabs();
        clearError();
      });

      function updateTabs() {
        if (isLogin) {
          loginTab.classList.add(
            "text-primary",
            "border-b-2",
            "border-primary"
          );
          loginTab.classList.remove("text-gray-500");
          registerTab.classList.remove(
            "text-primary",
            "border-b-2",
            "border-primary"
          );
          registerTab.classList.add("text-gray-500");
          btnText.textContent = "Ingresar";
        } else {
          registerTab.classList.add(
            "text-primary",
            "border-b-2",
            "border-primary"
          );
          registerTab.classList.remove("text-gray-500");
          loginTab.classList.remove(
            "text-primary",
            "border-b-2",
            "border-primary"
          );
          loginTab.classList.add("text-gray-500");
          btnText.textContent = "Crear Cuenta";
        }
      }

      // Inputs
      emailInput.addEventListener("input", (e) => {
        email = e.target.value;
      });

      passwordInput.addEventListener("input", (e) => {
        password = e.target.value;
      });

      // Funci√≥n para mostrar error
      function showError(message) {
        errorDiv.textContent = message;
        errorDiv.classList.remove("hidden");
      }

      function clearError() {
        errorDiv.textContent = "";
        errorDiv.classList.add("hidden");
      }

      // Funci√≥n para mostrar/ocultar loading
      function setLoading(isLoading) {
        loading = isLoading;
        if (isLoading) {
          submitBtn.disabled = true;
          submitBtn.classList.add("bg-gray-400", "cursor-not-allowed");
          submitBtn.classList.remove("bg-primary", "hover:bg-red-600");
          spinner.classList.remove("hidden");
          btnText.textContent = "Procesando...";
        } else {
          submitBtn.disabled = false;
          submitBtn.classList.remove("bg-gray-400", "cursor-not-allowed");
          submitBtn.classList.add("bg-primary", "hover:bg-red-600");
          spinner.classList.add("hidden");
          btnText.textContent = isLogin ? "Ingresar" : "Crear Cuenta";
        }
      }

      // Manejar submit
      submitBtn.addEventListener("click", async (e) => {
        e.preventDefault();
        clearError();

        if (!email || !password) {
          showError("Por favor completa todos los campos");
          return;
        }

        setLoading(true);

        try {
          if (isLogin) {
            // Login
            await signInWithEmailAndPassword(auth, email, password);
            alert("¬°Inicio de sesi√≥n exitoso!");
          } else {
            // Registro
            const userCredential = await createUserWithEmailAndPassword(
              auth,
              email,
              password
            );
            const user = userCredential.user;

            // Crear documento en Firestore
            await setDoc(doc(db, "USUARIOS", user.uid), {
              ID: user.uid,
              EMAIL: email,
              SALDO: 0,
            });

            alert("¬°Cuenta creada exitosamente!");
          }

          // Limpiar campos
          emailInput.value = "";
          passwordInput.value = "";
          email = "";
          password = "";
        } catch (err) {
          const errorMessage =
            err.code === "auth/user-not-found"
              ? "Usuario no encontrado"
              : err.code === "auth/wrong-password"
              ? "Contrase√±a incorrecta"
              : err.code === "auth/email-already-in-use"
              ? "El email ya est√° registrado"
              : err.code === "auth/weak-password"
              ? "La contrase√±a debe tener al menos 6 caracteres"
              : err.code === "auth/invalid-email"
              ? "Email inv√°lido"
              : "Error al autenticar. Intent√° nuevamente.";

          showError(errorMessage);
        } finally {
          setLoading(false);
        }
      });

      // Permitir submit con Enter
      passwordInput.addEventListener("keypress", (e) => {
        if (e.key === "Enter" && !loading) {
          submitBtn.click();
        }
      });
    </script>
  </head>
  <body>
    <div
      class="min-h-screen bg-gradient-to-br from-secondary to-gray-800 flex items-center justify-center p-4">
      <div class="bg-white rounded-lg shadow-2xl max-w-md w-full p-8">
        <!-- Logo/Header -->
        <div class="text-center mb-8">
          <div class="text-6xl mb-4">üèá</div>
          <h1 class="text-3xl font-bold text-secondary mb-2">
            Horse Racing Bet
          </h1>
          <p class="text-gray-600">Apuestas en carreras de Argentina</p>
        </div>

        <!-- Tabs -->
        <div class="flex mb-6 border-b border-gray-200">
          <button
            id="loginTab"
            class="flex-1 py-2 font-medium transition-colors text-primary border-b-2 border-primary">
            Iniciar Sesi√≥n
          </button>
          <button
            id="registerTab"
            class="flex-1 py-2 font-medium transition-colors text-gray-500">
            Registrarse
          </button>
        </div>

        <!-- Form -->
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Email
            </label>
            <input
              type="email"
              id="emailInput"
              required
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
              placeholder="tu@email.com" />
          </div>

          <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">
              Contrase√±a
            </label>
            <input
              type="password"
              id="passwordInput"
              required
              minlength="6"
              class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"
              placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" />
          </div>

          <!-- Error message -->
          <div
            id="errorDiv"
            class="bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-lg text-sm hidden"></div>

          <button
            id="submitBtn"
            class="w-full font-bold py-3 rounded-lg transition-colors bg-primary hover:bg-red-600 text-white">
            <span class="flex items-center justify-center">
              <svg
                id="spinner"
                class="animate-spin h-5 w-5 mr-2 hidden"
                viewBox="0 0 24 24">
                <circle
                  class="opacity-25"
                  cx="12"
                  cy="12"
                  r="10"
                  stroke="currentColor"
                  stroke-width="4"
                  fill="none" />
                <path
                  class="opacity-75"
                  fill="currentColor"
                  d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z" />
              </svg>
              <span id="btnText">Ingresar</span>
            </span>
          </button>
        </div>

        <!-- Info -->
        <div class="mt-6 text-center text-xs text-gray-500">
          <p>‚ö†Ô∏è Debe ser mayor de 18 a√±os para apostar</p>
          <p class="mt-1">üîí Tus datos est√°n protegidos</p>
        </div>
      </div>
    </div>
  </body>
</html>
